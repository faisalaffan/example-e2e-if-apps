"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _cssSelectorParser = require("css-selector-parser");
var _lodash = _interopRequireDefault(require("lodash"));
var _driver = require("appium/driver");
var _logger = _interopRequireDefault(require("./logger"));
const parseCssSelector = (0, _cssSelectorParser.createParser)({
  syntax: {
    pseudoClasses: {
      unknown: 'accept',
      definitions: {
        Selector: ['has']
      }
    },
    combinators: ['>', '+', '~'],
    attributes: {
      operators: ['^=', '$=', '*=', '~=', '=']
    },
    ids: true,
    classNames: true,
    tag: {
      wildcard: true
    }
  },
  substitutes: true
});
const RESOURCE_ID = 'resource-id';
const ID_LOCATOR_PATTERN = /^[a-zA-Z_][a-zA-Z0-9._]*:id\/[\S]+$/;
const BOOLEAN_ATTRS = ['checkable', 'checked', 'clickable', 'enabled', 'focusable', 'focused', 'long-clickable', 'scrollable', 'selected'];
const NUMERIC_ATTRS = ['index', 'instance'];
const STR_ATTRS = ['description', RESOURCE_ID, 'text', 'class-name', 'package-name'];
const ALL_ATTRS = [...BOOLEAN_ATTRS, ...NUMERIC_ATTRS, ...STR_ATTRS];
const ATTRIBUTE_ALIASES = [[RESOURCE_ID, ['id']], ['description', ['content-description', 'content-desc', 'desc', 'accessibility-id']], ['index', ['nth-child']]];
function toSnakeCase(str) {
  if (!str) {
    return '';
  }
  const tokens = str.split('-').map(str => str.charAt(0).toUpperCase() + str.slice(1).toLowerCase());
  const out = tokens.join('');
  return out.charAt(0).toLowerCase() + out.slice(1);
}
function requireBoolean(css) {
  var _ref;
  const val = _lodash.default.toLower((_ref = css.value ?? css.argument) === null || _ref === void 0 ? void 0 : _ref.value) || 'true';
  if (['true', 'false'].includes(val)) {
    return val;
  }
  throw new Error(`'${css.name}' must be true, false or empty. Found '${css.value}'`);
}
function requireEntityName(cssEntity) {
  const attrName = cssEntity.name.toLowerCase();
  if (ALL_ATTRS.includes(attrName)) {
    return attrName.toLowerCase();
  }
  for (const [officialAttr, aliasAttrs] of ATTRIBUTE_ALIASES) {
    if (aliasAttrs.includes(attrName)) {
      return officialAttr;
    }
  }
  throw new Error(`'${attrName}' is not a valid attribute. ` + `Supported attributes are '${ALL_ATTRS.join(', ')}'`);
}
function getWordMatcherRegex(word) {
  return `\\b(\\w*${_lodash.default.escapeRegExp(word)}\\w*)\\b`;
}
class CssConverter {
  constructor(selector, pkg) {
    this.selector = selector;
    this.pkg = pkg;
  }
  formatIdLocator(locator) {
    return ID_LOCATOR_PATTERN.test(locator) ? locator : `${this.pkg || 'android'}:id/${locator}`;
  }
  parseAttr(cssAttr) {
    var _cssAttr$value;
    const attrValue = (_cssAttr$value = cssAttr.value) === null || _cssAttr$value === void 0 ? void 0 : _cssAttr$value.value;
    if (!_lodash.default.isString(attrValue) && !_lodash.default.isEmpty(attrValue)) {
      throw new Error(`'${cssAttr.name}=${attrValue}' is an invalid attribute. ` + `Only 'string' and empty attribute types are supported. Found '${attrValue}'`);
    }
    const attrName = requireEntityName(cssAttr);
    const methodName = toSnakeCase(attrName);
    if (!STR_ATTRS.includes(attrName) && !BOOLEAN_ATTRS.includes(attrName)) {
      throw new Error(`'${attrName}' is not supported. Supported attributes are ` + `'${[...STR_ATTRS, ...BOOLEAN_ATTRS].join(', ')}'`);
    }
    if (BOOLEAN_ATTRS.includes(attrName)) {
      return `.${methodName}(${requireBoolean(cssAttr)})`;
    }
    let value = attrValue || '';
    if (attrName === RESOURCE_ID) {
      value = this.formatIdLocator(value);
    }
    if (value === '') {
      return `.${methodName}Matches("")`;
    }
    switch (cssAttr.operator) {
      case '=':
        return `.${methodName}("${value}")`;
      case '*=':
        if (['description', 'text'].includes(attrName)) {
          return `.${methodName}Contains("${value}")`;
        }
        return `.${methodName}Matches("${_lodash.default.escapeRegExp(value)}")`;
      case '^=':
        if (['description', 'text'].includes(attrName)) {
          return `.${methodName}StartsWith("${value}")`;
        }
        return `.${methodName}Matches("^${_lodash.default.escapeRegExp(value)}")`;
      case '$=':
        return `.${methodName}Matches("${_lodash.default.escapeRegExp(value)}$")`;
      case '~=':
        return `.${methodName}Matches("${getWordMatcherRegex(value)}")`;
      default:
        throw new Error(`Unsupported CSS attribute operator '${cssAttr.operator}'. ` + ` '=', '*=', '^=', '$=' and '~=' are supported.`);
    }
  }
  parsePseudo(cssPseudo) {
    var _cssPseudo$argument;
    const argValue = (_cssPseudo$argument = cssPseudo.argument) === null || _cssPseudo$argument === void 0 ? void 0 : _cssPseudo$argument.value;
    if (!_lodash.default.isString(argValue) && !_lodash.default.isEmpty(argValue)) {
      throw new Error(`'${cssPseudo.name}=${argValue}'. ` + `Unsupported css pseudo class value: '${argValue}'. Only 'string' type or empty is supported.`);
    }
    const pseudoName = requireEntityName(cssPseudo);
    if (BOOLEAN_ATTRS.includes(pseudoName)) {
      return `.${toSnakeCase(pseudoName)}(${requireBoolean(cssPseudo)})`;
    }
    if (NUMERIC_ATTRS.includes(pseudoName)) {
      return `.${pseudoName}(${argValue})`;
    }
  }
  parseCssRule(cssRule) {
    var _cssRule$tag;
    if (cssRule.combinator && ![' ', '>'].includes(cssRule.combinator)) {
      throw new Error(`'${cssRule.combinator}' is not a supported combinator. ` + `Only child combinator (>) and descendant combinator are supported.`);
    }
    let uiAutomatorSelector = 'new UiSelector()';
    const tagName = (_cssRule$tag = cssRule.tag) === null || _cssRule$tag === void 0 ? void 0 : _cssRule$tag.name;
    if (tagName && tagName !== '*') {
      let androidClass = [tagName];
      if (cssRule.classNames) {
        for (const cssClassNames of cssRule.classNames) {
          androidClass.push(cssClassNames);
        }
        uiAutomatorSelector += `.className("${androidClass.join('.')}")`;
      } else {
        uiAutomatorSelector += `.classNameMatches("${tagName}")`;
      }
    } else if (!_lodash.default.isEmpty(cssRule.classNames)) {
      uiAutomatorSelector += `.classNameMatches("${cssRule.classNames.join('\\.')}")`;
    }
    if (!_lodash.default.isEmpty(cssRule.ids)) {
      uiAutomatorSelector += `.resourceId("${this.formatIdLocator(cssRule.ids[0])}")`;
    }
    if (cssRule.attributes) {
      for (const attr of cssRule.attributes) {
        uiAutomatorSelector += this.parseAttr(attr);
      }
    }
    if (cssRule.pseudoClasses) {
      for (const pseudo of cssRule.pseudoClasses) {
        const sel = this.parsePseudo(pseudo);
        if (sel) {
          uiAutomatorSelector += sel;
        }
      }
    }
    if (cssRule.nestedRule) {
      uiAutomatorSelector += `.childSelector(${this.parseCssRule(cssRule.nestedRule)})`;
    }
    return uiAutomatorSelector;
  }
  parseCssObject(css) {
    if (!_lodash.default.isEmpty(css.rules)) {
      return this.parseCssRule(css.rules[0]);
    }
    throw new Error('No rules could be parsed out of the current selector');
  }
  toUiAutomatorSelector() {
    let cssObj;
    try {
      cssObj = parseCssSelector(this.selector);
    } catch (e) {
      _logger.default.debug(e.stack);
      throw new _driver.errors.InvalidSelectorError(`Invalid CSS selector '${this.selector}'. Reason: '${e.message}'`);
    }
    try {
      return this.parseCssObject(cssObj);
    } catch (e) {
      _logger.default.debug(e.stack);
      throw new _driver.errors.InvalidSelectorError(`Unsupported CSS selector '${this.selector}'. Reason: '${e.message}'`);
    }
  }
}
var _default = CssConverter;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY3NzU2VsZWN0b3JQYXJzZXIiLCJyZXF1aXJlIiwiX2xvZGFzaCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfZHJpdmVyIiwiX2xvZ2dlciIsInBhcnNlQ3NzU2VsZWN0b3IiLCJjcmVhdGVQYXJzZXIiLCJzeW50YXgiLCJwc2V1ZG9DbGFzc2VzIiwidW5rbm93biIsImRlZmluaXRpb25zIiwiU2VsZWN0b3IiLCJjb21iaW5hdG9ycyIsImF0dHJpYnV0ZXMiLCJvcGVyYXRvcnMiLCJpZHMiLCJjbGFzc05hbWVzIiwidGFnIiwid2lsZGNhcmQiLCJzdWJzdGl0dXRlcyIsIlJFU09VUkNFX0lEIiwiSURfTE9DQVRPUl9QQVRURVJOIiwiQk9PTEVBTl9BVFRSUyIsIk5VTUVSSUNfQVRUUlMiLCJTVFJfQVRUUlMiLCJBTExfQVRUUlMiLCJBVFRSSUJVVEVfQUxJQVNFUyIsInRvU25ha2VDYXNlIiwic3RyIiwidG9rZW5zIiwic3BsaXQiLCJtYXAiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwidG9Mb3dlckNhc2UiLCJvdXQiLCJqb2luIiwicmVxdWlyZUJvb2xlYW4iLCJjc3MiLCJfcmVmIiwidmFsIiwiXyIsInRvTG93ZXIiLCJ2YWx1ZSIsImFyZ3VtZW50IiwiaW5jbHVkZXMiLCJFcnJvciIsIm5hbWUiLCJyZXF1aXJlRW50aXR5TmFtZSIsImNzc0VudGl0eSIsImF0dHJOYW1lIiwib2ZmaWNpYWxBdHRyIiwiYWxpYXNBdHRycyIsImdldFdvcmRNYXRjaGVyUmVnZXgiLCJ3b3JkIiwiZXNjYXBlUmVnRXhwIiwiQ3NzQ29udmVydGVyIiwiY29uc3RydWN0b3IiLCJzZWxlY3RvciIsInBrZyIsImZvcm1hdElkTG9jYXRvciIsImxvY2F0b3IiLCJ0ZXN0IiwicGFyc2VBdHRyIiwiY3NzQXR0ciIsIl9jc3NBdHRyJHZhbHVlIiwiYXR0clZhbHVlIiwiaXNTdHJpbmciLCJpc0VtcHR5IiwibWV0aG9kTmFtZSIsIm9wZXJhdG9yIiwicGFyc2VQc2V1ZG8iLCJjc3NQc2V1ZG8iLCJfY3NzUHNldWRvJGFyZ3VtZW50IiwiYXJnVmFsdWUiLCJwc2V1ZG9OYW1lIiwicGFyc2VDc3NSdWxlIiwiY3NzUnVsZSIsIl9jc3NSdWxlJHRhZyIsImNvbWJpbmF0b3IiLCJ1aUF1dG9tYXRvclNlbGVjdG9yIiwidGFnTmFtZSIsImFuZHJvaWRDbGFzcyIsImNzc0NsYXNzTmFtZXMiLCJwdXNoIiwiYXR0ciIsInBzZXVkbyIsInNlbCIsIm5lc3RlZFJ1bGUiLCJwYXJzZUNzc09iamVjdCIsInJ1bGVzIiwidG9VaUF1dG9tYXRvclNlbGVjdG9yIiwiY3NzT2JqIiwiZSIsImxvZyIsImRlYnVnIiwic3RhY2siLCJlcnJvcnMiLCJJbnZhbGlkU2VsZWN0b3JFcnJvciIsIm1lc3NhZ2UiLCJfZGVmYXVsdCIsImV4cG9ydHMiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vbGliL2Nzcy1jb252ZXJ0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlUGFyc2VyIH0gZnJvbSAnY3NzLXNlbGVjdG9yLXBhcnNlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtL2RyaXZlcic7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcblxuY29uc3QgcGFyc2VDc3NTZWxlY3RvciA9IGNyZWF0ZVBhcnNlcih7XG4gIHN5bnRheDoge1xuICAgIHBzZXVkb0NsYXNzZXM6IHtcbiAgICAgIHVua25vd246ICdhY2NlcHQnLFxuICAgICAgZGVmaW5pdGlvbnM6IHtcbiAgICAgICAgU2VsZWN0b3I6IFsnaGFzJ10sXG4gICAgICB9XG4gICAgfSxcbiAgICBjb21iaW5hdG9yczogWyc+JywgJysnLCAnfiddLFxuICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgIG9wZXJhdG9yczogWydePScsICckPScsICcqPScsICd+PScsICc9J11cbiAgICB9LFxuICAgIGlkczogdHJ1ZSxcbiAgICBjbGFzc05hbWVzOiB0cnVlLFxuICAgIHRhZzoge1xuICAgICAgd2lsZGNhcmQ6IHRydWVcbiAgICB9LFxuICB9LFxuICBzdWJzdGl0dXRlczogdHJ1ZVxufSk7XG5cbmNvbnN0IFJFU09VUkNFX0lEID0gJ3Jlc291cmNlLWlkJztcbmNvbnN0IElEX0xPQ0FUT1JfUEFUVEVSTiA9IC9eW2EtekEtWl9dW2EtekEtWjAtOS5fXSo6aWRcXC9bXFxTXSskLztcblxuY29uc3QgQk9PTEVBTl9BVFRSUyA9IFtcbiAgJ2NoZWNrYWJsZScsICdjaGVja2VkJywgJ2NsaWNrYWJsZScsICdlbmFibGVkJywgJ2ZvY3VzYWJsZScsXG4gICdmb2N1c2VkJywgJ2xvbmctY2xpY2thYmxlJywgJ3Njcm9sbGFibGUnLCAnc2VsZWN0ZWQnLFxuXTtcblxuY29uc3QgTlVNRVJJQ19BVFRSUyA9IFtcbiAgJ2luZGV4JywgJ2luc3RhbmNlJyxcbl07XG5cbmNvbnN0IFNUUl9BVFRSUyA9IFtcbiAgJ2Rlc2NyaXB0aW9uJywgUkVTT1VSQ0VfSUQsICd0ZXh0JywgJ2NsYXNzLW5hbWUnLCAncGFja2FnZS1uYW1lJ1xuXTtcblxuY29uc3QgQUxMX0FUVFJTID0gW1xuICAuLi5CT09MRUFOX0FUVFJTLFxuICAuLi5OVU1FUklDX0FUVFJTLFxuICAuLi5TVFJfQVRUUlMsXG5dO1xuXG5jb25zdCBBVFRSSUJVVEVfQUxJQVNFUyA9IFtcbiAgW1JFU09VUkNFX0lELCBbJ2lkJ11dLFxuICBbJ2Rlc2NyaXB0aW9uJywgW1xuICAgICdjb250ZW50LWRlc2NyaXB0aW9uJywgJ2NvbnRlbnQtZGVzYycsXG4gICAgJ2Rlc2MnLCAnYWNjZXNzaWJpbGl0eS1pZCcsXG4gIF1dLFxuICBbJ2luZGV4JywgWydudGgtY2hpbGQnXV0sXG5dO1xuXG4vKipcbiAqIENvbnZlcnQgaHlwaGVuIHNlcGFyYXRlZCB3b3JkIHRvIHNuYWtlIGNhc2VcbiAqXG4gKiBAcGFyYW0ge3N0cmluZz99IHN0clxuICogQHJldHVybnMge3N0cmluZ30gVGhlIGh5cGhlbiBzZXBhcmF0ZWQgd29yZCB0cmFuc2xhdGVkIHRvIHNuYWtlIGNhc2VcbiAqL1xuZnVuY3Rpb24gdG9TbmFrZUNhc2UgKHN0cikge1xuICBpZiAoIXN0cikge1xuICAgIHJldHVybiAnJztcbiAgfVxuICBjb25zdCB0b2tlbnMgPSBzdHIuc3BsaXQoJy0nKS5tYXAoKHN0cikgPT4gc3RyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyLnNsaWNlKDEpLnRvTG93ZXJDYXNlKCkpO1xuICBjb25zdCBvdXQgPSB0b2tlbnMuam9pbignJyk7XG4gIHJldHVybiBvdXQuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBvdXQuc2xpY2UoMSk7XG59XG5cbi8qKlxuICogR2V0IHRoZSBib29sZWFuIGZyb20gYSBDU1Mgb2JqZWN0LiBJZiBlbXB0eSwgcmV0dXJuIHRydWUuIElmIG5vdCB0cnVlL2ZhbHNlL2VtcHR5LCB0aHJvdyBleGNlcHRpb25cbiAqXG4gKiBAcGFyYW0ge2ltcG9ydCgnY3NzLXNlbGVjdG9yLXBhcnNlcicpLkFzdEF0dHJpYnV0ZXxpbXBvcnQoJ2Nzcy1zZWxlY3Rvci1wYXJzZXInKS5Bc3RQc2V1ZG9DbGFzc30gY3NzIEFcbiAqIENTUyBvYmplY3QgdGhhdCBoYXMgJ25hbWUnIGFuZCAndmFsdWUnXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBFaXRoZXIgJ3RydWUnIG9yICdmYWxzZScuIElmIHZhbHVlIGlzIGVtcHR5LCByZXR1cm4gJ3RydWUnXG4gKi9cbmZ1bmN0aW9uIHJlcXVpcmVCb29sZWFuIChjc3MpIHtcbiAgY29uc3QgdmFsID0gXy50b0xvd2VyKChjc3MudmFsdWUgPz8gY3NzLmFyZ3VtZW50KT8udmFsdWUpIHx8ICd0cnVlJzsgLy8gYW4gb21pdHRlZCBib29sZWFuIGF0dHJpYnV0ZSBtZWFucyAndHJ1ZScgKGUuZy46IGlucHV0W2NoZWNrZWRdIG1lYW5zIGNoZWNrZWQgaXMgdHJ1ZSlcbiAgaWYgKFsndHJ1ZScsICdmYWxzZSddLmluY2x1ZGVzKHZhbCkpIHtcbiAgICByZXR1cm4gdmFsO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgJyR7Y3NzLm5hbWV9JyBtdXN0IGJlIHRydWUsIGZhbHNlIG9yIGVtcHR5LiBGb3VuZCAnJHtjc3MudmFsdWV9J2ApO1xufVxuXG4vKipcbiAqIEdldCB0aGUgY2Fub25pY2FsIGZvcm0gb2YgYSBDU1MgYXR0cmlidXRlIG5hbWVcbiAqXG4gKiBDb252ZXJ0cyB0byBsb3dlcmNhc2UgYW5kIGlmIGFuIGF0dHJpYnV0ZSBuYW1lIGlzIGFuIGFsaWFzIGZvciBzb21ldGhpbmcgZWxzZSwgcmV0dXJuXG4gKiB3aGF0IGl0IGlzIGFuIGFsaWFzIGZvclxuICpcbiAqIEBwYXJhbSB7aW1wb3J0KCdjc3Mtc2VsZWN0b3ItcGFyc2VyJykuQXN0QXR0cmlidXRlfGltcG9ydCgnY3NzLXNlbGVjdG9yLXBhcnNlcicpLkFzdFBzZXVkb0NsYXNzfSBjc3NFbnRpdHkgQ1NTIG9iamVjdFxuICogQHJldHVybnMge3N0cmluZ30gVGhlIGNhbm9uaWNhbCBhdHRyaWJ1dGUgbmFtZVxuICovXG5mdW5jdGlvbiByZXF1aXJlRW50aXR5TmFtZSAoY3NzRW50aXR5KSB7XG4gIGNvbnN0IGF0dHJOYW1lID0gY3NzRW50aXR5Lm5hbWUudG9Mb3dlckNhc2UoKTtcblxuICAvLyBDaGVjayBpZiBpdCdzIHN1cHBvcnRlZCBhbmQgaWYgaXQgaXMsIHJldHVybiBpdFxuICBpZiAoQUxMX0FUVFJTLmluY2x1ZGVzKGF0dHJOYW1lKSkge1xuICAgIHJldHVybiBhdHRyTmFtZS50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgLy8gSWYgYXR0ck5hbWUgaXMgYW4gYWxpYXMgZm9yIHNvbWV0aGluZyBlbHNlLCByZXR1cm4gdGhhdFxuICBmb3IgKGNvbnN0IFtvZmZpY2lhbEF0dHIsIGFsaWFzQXR0cnNdIG9mIEFUVFJJQlVURV9BTElBU0VTKSB7XG4gICAgaWYgKGFsaWFzQXR0cnMuaW5jbHVkZXMoYXR0ck5hbWUpKSB7XG4gICAgICByZXR1cm4gb2ZmaWNpYWxBdHRyO1xuICAgIH1cbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYCcke2F0dHJOYW1lfScgaXMgbm90IGEgdmFsaWQgYXR0cmlidXRlLiBgICtcbiAgICBgU3VwcG9ydGVkIGF0dHJpYnV0ZXMgYXJlICcke0FMTF9BVFRSUy5qb2luKCcsICcpfSdgKTtcbn1cblxuLyoqXG4gKiBHZXQgYSByZWdleCB0aGF0IG1hdGNoZXMgYSB3aG9sZSB3b3JkLiBGb3IgdGhlIH49IENTUyBhdHRyaWJ1dGUgc2VsZWN0b3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHdvcmRcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEEgcmVnZXggXCJ3b3JkXCIgbWF0Y2hlclxuICovXG5mdW5jdGlvbiBnZXRXb3JkTWF0Y2hlclJlZ2V4ICh3b3JkKSB7XG4gIHJldHVybiBgXFxcXGIoXFxcXHcqJHtfLmVzY2FwZVJlZ0V4cCh3b3JkKX1cXFxcdyopXFxcXGJgO1xufVxuXG5cbmNsYXNzIENzc0NvbnZlcnRlciB7XG5cbiAgY29uc3RydWN0b3IgKHNlbGVjdG9yLCBwa2cpIHtcbiAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7XG4gICAgdGhpcy5wa2cgPSBwa2c7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGA8cGtnTmFtZT46aWQvYCBwcmVmaXggdG8gYmVnaW5uaW5nIG9mIHN0cmluZyBpZiBpdCdzIG5vdCB0aGVyZSBhbHJlYWR5XG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhdG9yIFRoZSBpbml0aWFsIGxvY2F0b3JcbiAgICogQHJldHVybnMge3N0cmluZ30gU3RyaW5nIHdpdGggYDxwa2dOYW1lPjppZC9gIHByZXBlbmRlZCAoaWYgaXQgd2Fzbid0IGFscmVhZHkpXG4gICAqL1xuICBmb3JtYXRJZExvY2F0b3IgKGxvY2F0b3IpIHtcbiAgICByZXR1cm4gSURfTE9DQVRPUl9QQVRURVJOLnRlc3QobG9jYXRvcilcbiAgICAgID8gbG9jYXRvclxuICAgICAgOiBgJHt0aGlzLnBrZyB8fCAnYW5kcm9pZCd9OmlkLyR7bG9jYXRvcn1gO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgYSBDU1MgYXR0cmlidXRlIGludG8gYSBVaVNlbGVjdG9yIG1ldGhvZCBjYWxsXG4gICAqXG4gICAqIEBwYXJhbSB7aW1wb3J0KCdjc3Mtc2VsZWN0b3ItcGFyc2VyJykuQXN0QXR0cmlidXRlfSBjc3NBdHRyIENTUyBhdHRyaWJ1dGUgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IENTUyBhdHRyaWJ1dGUgcGFyc2VkIGFzIFVpU2VsZWN0b3JcbiAgICovXG4gIHBhcnNlQXR0ciAoY3NzQXR0cikge1xuICAgIGNvbnN0IGF0dHJWYWx1ZSA9IGNzc0F0dHIudmFsdWU/LnZhbHVlO1xuICAgIGlmICghXy5pc1N0cmluZyhhdHRyVmFsdWUpICYmICFfLmlzRW1wdHkoYXR0clZhbHVlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtjc3NBdHRyLm5hbWV9PSR7YXR0clZhbHVlfScgaXMgYW4gaW52YWxpZCBhdHRyaWJ1dGUuIGAgK1xuICAgICAgICBgT25seSAnc3RyaW5nJyBhbmQgZW1wdHkgYXR0cmlidXRlIHR5cGVzIGFyZSBzdXBwb3J0ZWQuIEZvdW5kICcke2F0dHJWYWx1ZX0nYCk7XG4gICAgfVxuICAgIGNvbnN0IGF0dHJOYW1lID0gcmVxdWlyZUVudGl0eU5hbWUoY3NzQXR0cik7XG4gICAgY29uc3QgbWV0aG9kTmFtZSA9IHRvU25ha2VDYXNlKGF0dHJOYW1lKTtcblxuICAgIC8vIFZhbGlkYXRlIHRoYXQgaXQncyBhIHN1cHBvcnRlZCBhdHRyaWJ1dGVcbiAgICBpZiAoIVNUUl9BVFRSUy5pbmNsdWRlcyhhdHRyTmFtZSkgJiYgIUJPT0xFQU5fQVRUUlMuaW5jbHVkZXMoYXR0ck5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCcke2F0dHJOYW1lfScgaXMgbm90IHN1cHBvcnRlZC4gU3VwcG9ydGVkIGF0dHJpYnV0ZXMgYXJlIGAgK1xuICAgICAgICBgJyR7Wy4uLlNUUl9BVFRSUywgLi4uQk9PTEVBTl9BVFRSU10uam9pbignLCAnKX0nYCk7XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgYm9vbGVhbiwgaWYgaXQncyBhIGJvb2xlYW4gYXR0cmlidXRlXG4gICAgaWYgKEJPT0xFQU5fQVRUUlMuaW5jbHVkZXMoYXR0ck5hbWUpKSB7XG4gICAgICByZXR1cm4gYC4ke21ldGhvZE5hbWV9KCR7cmVxdWlyZUJvb2xlYW4oY3NzQXR0cil9KWA7XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlIHBhcnNlIGFzIHN0cmluZ1xuICAgIGxldCB2YWx1ZSA9IGF0dHJWYWx1ZSB8fCAnJztcbiAgICBpZiAoYXR0ck5hbWUgPT09IFJFU09VUkNFX0lEKSB7XG4gICAgICB2YWx1ZSA9IHRoaXMuZm9ybWF0SWRMb2NhdG9yKHZhbHVlKTtcbiAgICB9XG4gICAgaWYgKHZhbHVlID09PSAnJykge1xuICAgICAgcmV0dXJuIGAuJHttZXRob2ROYW1lfU1hdGNoZXMoXCJcIilgO1xuICAgIH1cblxuICAgIHN3aXRjaCAoY3NzQXR0ci5vcGVyYXRvcikge1xuICAgICAgY2FzZSAnPSc6XG4gICAgICAgIHJldHVybiBgLiR7bWV0aG9kTmFtZX0oXCIke3ZhbHVlfVwiKWA7XG4gICAgICBjYXNlICcqPSc6XG4gICAgICAgIGlmIChbJ2Rlc2NyaXB0aW9uJywgJ3RleHQnXS5pbmNsdWRlcyhhdHRyTmFtZSkpIHtcbiAgICAgICAgICByZXR1cm4gYC4ke21ldGhvZE5hbWV9Q29udGFpbnMoXCIke3ZhbHVlfVwiKWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAuJHttZXRob2ROYW1lfU1hdGNoZXMoXCIke18uZXNjYXBlUmVnRXhwKHZhbHVlKX1cIilgO1xuICAgICAgY2FzZSAnXj0nOlxuICAgICAgICBpZiAoWydkZXNjcmlwdGlvbicsICd0ZXh0J10uaW5jbHVkZXMoYXR0ck5hbWUpKSB7XG4gICAgICAgICAgcmV0dXJuIGAuJHttZXRob2ROYW1lfVN0YXJ0c1dpdGgoXCIke3ZhbHVlfVwiKWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAuJHttZXRob2ROYW1lfU1hdGNoZXMoXCJeJHtfLmVzY2FwZVJlZ0V4cCh2YWx1ZSl9XCIpYDtcbiAgICAgIGNhc2UgJyQ9JzpcbiAgICAgICAgcmV0dXJuIGAuJHttZXRob2ROYW1lfU1hdGNoZXMoXCIke18uZXNjYXBlUmVnRXhwKHZhbHVlKX0kXCIpYDtcbiAgICAgIGNhc2UgJ349JzpcbiAgICAgICAgcmV0dXJuIGAuJHttZXRob2ROYW1lfU1hdGNoZXMoXCIke2dldFdvcmRNYXRjaGVyUmVnZXgodmFsdWUpfVwiKWA7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICAvLyBVbnJlYWNoYWJsZSwgYnV0IGFkZGluZyBlcnJvciBpbiBjYXNlIGEgbmV3IENTUyBhdHRyaWJ1dGUgaXMgYWRkZWQuXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgQ1NTIGF0dHJpYnV0ZSBvcGVyYXRvciAnJHtjc3NBdHRyLm9wZXJhdG9yfScuIGAgK1xuICAgICAgICAgIGAgJz0nLCAnKj0nLCAnXj0nLCAnJD0nIGFuZCAnfj0nIGFyZSBzdXBwb3J0ZWQuYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgYSBDU1MgcHNldWRvIGNsYXNzIHRvIGEgVWlTZWxlY3RvclxuICAgKlxuICAgKiBAcGFyYW0ge2ltcG9ydCgnY3NzLXNlbGVjdG9yLXBhcnNlcicpLkFzdFBzZXVkb0NsYXNzfSBjc3NQc2V1ZG8gQ1NTIFBzZXVkbyBjbGFzc1xuICAgKiBAcmV0dXJucyB7c3RyaW5nP30gUHNldWRvIHNlbGVjdG9yIHBhcnNlZCBhcyBVaVNlbGVjdG9yXG4gICAqL1xuICBwYXJzZVBzZXVkbyAoY3NzUHNldWRvKSB7XG4gICAgY29uc3QgYXJnVmFsdWUgPSBjc3NQc2V1ZG8uYXJndW1lbnQ/LnZhbHVlO1xuICAgIGlmICghXy5pc1N0cmluZyhhcmdWYWx1ZSkgJiYgIV8uaXNFbXB0eShhcmdWYWx1ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7Y3NzUHNldWRvLm5hbWV9PSR7YXJnVmFsdWV9Jy4gYCArXG4gICAgICAgIGBVbnN1cHBvcnRlZCBjc3MgcHNldWRvIGNsYXNzIHZhbHVlOiAnJHthcmdWYWx1ZX0nLiBPbmx5ICdzdHJpbmcnIHR5cGUgb3IgZW1wdHkgaXMgc3VwcG9ydGVkLmApO1xuICAgIH1cblxuICAgIGNvbnN0IHBzZXVkb05hbWUgPSByZXF1aXJlRW50aXR5TmFtZShjc3NQc2V1ZG8pO1xuXG4gICAgaWYgKEJPT0xFQU5fQVRUUlMuaW5jbHVkZXMocHNldWRvTmFtZSkpIHtcbiAgICAgIHJldHVybiBgLiR7dG9TbmFrZUNhc2UocHNldWRvTmFtZSl9KCR7cmVxdWlyZUJvb2xlYW4oY3NzUHNldWRvKX0pYDtcbiAgICB9XG5cbiAgICBpZiAoTlVNRVJJQ19BVFRSUy5pbmNsdWRlcyhwc2V1ZG9OYW1lKSkge1xuICAgICAgcmV0dXJuIGAuJHtwc2V1ZG9OYW1lfSgke2FyZ1ZhbHVlfSlgO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IGEgQ1NTIHJ1bGUgdG8gYSBVaVNlbGVjdG9yXG4gICAqIEBwYXJhbSB7aW1wb3J0KCdjc3Mtc2VsZWN0b3ItcGFyc2VyJykuQXN0UnVsZX0gY3NzUnVsZSBDU1MgcnVsZSBkZWZpbml0aW9uXG4gICAqL1xuICBwYXJzZUNzc1J1bGUgKGNzc1J1bGUpIHtcbiAgICBpZiAoY3NzUnVsZS5jb21iaW5hdG9yICYmICFbJyAnLCAnPiddLmluY2x1ZGVzKGNzc1J1bGUuY29tYmluYXRvcikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7Y3NzUnVsZS5jb21iaW5hdG9yfScgaXMgbm90IGEgc3VwcG9ydGVkIGNvbWJpbmF0b3IuIGAgK1xuICAgICAgICBgT25seSBjaGlsZCBjb21iaW5hdG9yICg+KSBhbmQgZGVzY2VuZGFudCBjb21iaW5hdG9yIGFyZSBzdXBwb3J0ZWQuYCk7XG4gICAgfVxuXG4gICAgbGV0IHVpQXV0b21hdG9yU2VsZWN0b3IgPSAnbmV3IFVpU2VsZWN0b3IoKSc7XG4gICAgY29uc3QgdGFnTmFtZSA9IGNzc1J1bGUudGFnPy5uYW1lO1xuICAgIGlmICh0YWdOYW1lICYmIHRhZ05hbWUgIT09ICcqJykge1xuICAgICAgbGV0IGFuZHJvaWRDbGFzcyA9IFt0YWdOYW1lXTtcbiAgICAgIGlmIChjc3NSdWxlLmNsYXNzTmFtZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCBjc3NDbGFzc05hbWVzIG9mIGNzc1J1bGUuY2xhc3NOYW1lcykge1xuICAgICAgICAgIGFuZHJvaWRDbGFzcy5wdXNoKGNzc0NsYXNzTmFtZXMpO1xuICAgICAgICB9XG4gICAgICAgIHVpQXV0b21hdG9yU2VsZWN0b3IgKz0gYC5jbGFzc05hbWUoXCIke2FuZHJvaWRDbGFzcy5qb2luKCcuJyl9XCIpYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVpQXV0b21hdG9yU2VsZWN0b3IgKz0gYC5jbGFzc05hbWVNYXRjaGVzKFwiJHt0YWdOYW1lfVwiKWA7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghXy5pc0VtcHR5KGNzc1J1bGUuY2xhc3NOYW1lcykpIHtcbiAgICAgIHVpQXV0b21hdG9yU2VsZWN0b3IgKz0gYC5jbGFzc05hbWVNYXRjaGVzKFwiJHtjc3NSdWxlLmNsYXNzTmFtZXMuam9pbignXFxcXC4nKX1cIilgO1xuICAgIH1cbiAgICBpZiAoIV8uaXNFbXB0eShjc3NSdWxlLmlkcykpIHtcbiAgICAgIHVpQXV0b21hdG9yU2VsZWN0b3IgKz0gYC5yZXNvdXJjZUlkKFwiJHt0aGlzLmZvcm1hdElkTG9jYXRvcihjc3NSdWxlLmlkc1swXSl9XCIpYDtcbiAgICB9XG4gICAgaWYgKGNzc1J1bGUuYXR0cmlidXRlcykge1xuICAgICAgZm9yIChjb25zdCBhdHRyIG9mIGNzc1J1bGUuYXR0cmlidXRlcykge1xuICAgICAgICB1aUF1dG9tYXRvclNlbGVjdG9yICs9IHRoaXMucGFyc2VBdHRyKGF0dHIpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY3NzUnVsZS5wc2V1ZG9DbGFzc2VzKSB7XG4gICAgICBmb3IgKGNvbnN0IHBzZXVkbyBvZiBjc3NSdWxlLnBzZXVkb0NsYXNzZXMpIHtcbiAgICAgICAgY29uc3Qgc2VsID0gdGhpcy5wYXJzZVBzZXVkbyhwc2V1ZG8pO1xuICAgICAgICBpZiAoc2VsKSB7XG4gICAgICAgICAgdWlBdXRvbWF0b3JTZWxlY3RvciArPSBzZWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNzc1J1bGUubmVzdGVkUnVsZSkge1xuICAgICAgdWlBdXRvbWF0b3JTZWxlY3RvciArPSBgLmNoaWxkU2VsZWN0b3IoJHt0aGlzLnBhcnNlQ3NzUnVsZShjc3NSdWxlLm5lc3RlZFJ1bGUpfSlgO1xuICAgIH1cbiAgICByZXR1cm4gdWlBdXRvbWF0b3JTZWxlY3RvcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IENTUyBvYmplY3QgdG8gVWlBdXRvbWF0b3IyIHNlbGVjdG9yXG4gICAqIEBwYXJhbSB7aW1wb3J0KCdjc3Mtc2VsZWN0b3ItcGFyc2VyJykuQXN0U2VsZWN0b3J9IGNzcyBDU1Mgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBDU1Mgb2JqZWN0IHBhcnNlZCBhcyBhIFVpU2VsZWN0b3JcbiAgICovXG4gIHBhcnNlQ3NzT2JqZWN0IChjc3MpIHtcbiAgICBpZiAoIV8uaXNFbXB0eShjc3MucnVsZXMpKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZUNzc1J1bGUoY3NzLnJ1bGVzWzBdKTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHJ1bGVzIGNvdWxkIGJlIHBhcnNlZCBvdXQgb2YgdGhlIGN1cnJlbnQgc2VsZWN0b3InKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IGEgQ1NTIHNlbGVjdG9yIHRvIGEgVWlBdXRvbWF0b3IyIHNlbGVjdG9yXG4gICAqXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBDU1Mgc2VsZWN0b3IgY29udmVydGVkIHRvIGEgVWlTZWxlY3RvclxuICAgKi9cbiAgdG9VaUF1dG9tYXRvclNlbGVjdG9yICgpIHtcbiAgICBsZXQgY3NzT2JqO1xuICAgIHRyeSB7XG4gICAgICBjc3NPYmogPSBwYXJzZUNzc1NlbGVjdG9yKHRoaXMuc2VsZWN0b3IpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy5kZWJ1ZyhlLnN0YWNrKTtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZFNlbGVjdG9yRXJyb3IoYEludmFsaWQgQ1NTIHNlbGVjdG9yICcke3RoaXMuc2VsZWN0b3J9Jy4gUmVhc29uOiAnJHtlLm1lc3NhZ2V9J2ApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHRoaXMucGFyc2VDc3NPYmplY3QoY3NzT2JqKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cuZGVidWcoZS5zdGFjayk7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRTZWxlY3RvckVycm9yKGBVbnN1cHBvcnRlZCBDU1Mgc2VsZWN0b3IgJyR7dGhpcy5zZWxlY3Rvcn0nLiBSZWFzb246ICcke2UubWVzc2FnZX0nYCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENzc0NvbnZlcnRlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxrQkFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsT0FBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBRixzQkFBQSxDQUFBRixPQUFBO0FBRUEsTUFBTUssZ0JBQWdCLEdBQUcsSUFBQUMsK0JBQVksRUFBQztFQUNwQ0MsTUFBTSxFQUFFO0lBQ05DLGFBQWEsRUFBRTtNQUNiQyxPQUFPLEVBQUUsUUFBUTtNQUNqQkMsV0FBVyxFQUFFO1FBQ1hDLFFBQVEsRUFBRSxDQUFDLEtBQUs7TUFDbEI7SUFDRixDQUFDO0lBQ0RDLFdBQVcsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQzVCQyxVQUFVLEVBQUU7TUFDVkMsU0FB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