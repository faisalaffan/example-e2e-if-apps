"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.commands = void 0;
const lodash_1 = __importDefault(require("lodash"));
const teen_process_1 = require("teen_process");
const support_1 = require("@appium/support");
const driver_1 = require("appium/driver");
const utils_1 = require("../utils");
const commands = {};
exports.commands = commands;
commands.mobileShell = async function mobileShell(opts = {}) {
    this.ensureFeatureEnabled(utils_1.ADB_SHELL_FEATURE);
    const { command, args = [], timeout = 20000, includeStderr, } = opts;
    if (!lodash_1.default.isString(command)) {
        throw new driver_1.errors.InvalidArgumentError(`The 'command' argument is mandatory`);
    }
    const adbArgs = [
        ...this.adb.executable.defaultArgs,
        'shell',
        command,
        ...(lodash_1.default.isArray(args) ? args : [args])
    ];
    this.log.debug(`Running '${this.adb.executable.path} ${support_1.util.quote(adbArgs)}'`);
    try {
        const { stdout, stderr } = await (0, teen_process_1.exec)(this.adb.executable.path, adbArgs, { timeout });
        if (includeStderr) {
            return {
                stdout,
                stderr
            };
        }
        return stdout;
    }
    catch (err) {
        this.log.errorAndThrow(`Cannot execute the '${command}' shell command. ` +
            `Original error: ${err.message}. ` +
            `StdOut: ${err.stdout}. StdErr: ${err.stderr}`);
    }
};
exports.default = commands;
//# sourceMappingURL=shell.js.map